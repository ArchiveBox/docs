

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>archivebox.config &mdash; ArchiveBox 0.4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> ArchiveBox
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">How does it work?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#quickstart">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#screenshots">Screenshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Donations.html">Donations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Web-Archiving-Community.html">Web Archiving Community</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Docker.html">Docker</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Security-Overview.html">Security Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Publishing-Your-Archive.html">Publishing Your Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Scheduled-Archiving.html">Scheduled Archiving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chromium-Install.html">Chromium Install</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ArchiveBox</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>archivebox.config</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for archivebox.config</h1><div class="highlight"><pre>
<span></span><span class="n">__package__</span> <span class="o">=</span> <span class="s1">&#39;archivebox.config&#39;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">django</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">hashlib</span> <span class="k">import</span> <span class="n">md5</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="k">import</span> <span class="n">run</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">DEVNULL</span>
<span class="kn">from</span> <span class="nn">configparser</span> <span class="k">import</span> <span class="n">ConfigParser</span>

<span class="kn">from</span> <span class="nn">.stubs</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">SimpleConfigValueDict</span><span class="p">,</span>
    <span class="n">ConfigValue</span><span class="p">,</span>
    <span class="n">ConfigDict</span><span class="p">,</span>
    <span class="n">ConfigDefaultValue</span><span class="p">,</span>
    <span class="n">ConfigDefaultDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># ******************************************************************************</span>
<span class="c1"># Documentation: https://github.com/pirate/ArchiveBox/wiki/Configuration</span>
<span class="c1"># Use the &#39;env&#39; command to pass config options to ArchiveBox.  e.g.:</span>
<span class="c1">#     env USE_COLOR=True CHROME_BINARY=chromium archivebox add &lt; example.html</span>
<span class="c1"># ******************************************************************************</span>

<span class="c1">################################# User Config ##################################</span>

<span class="n">CONFIG_DEFAULTS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ConfigDefaultDict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;SHELL_CONFIG&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;IS_TTY&#39;</span><span class="p">:</span>                   <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">()},</span>
        <span class="s1">&#39;USE_COLOR&#39;</span><span class="p">:</span>                <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;IS_TTY&#39;</span><span class="p">]},</span>
        <span class="s1">&#39;SHOW_PROGRESS&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;IS_TTY&#39;</span><span class="p">]},</span>
    <span class="p">},</span>

    <span class="s1">&#39;GENERAL_CONFIG&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
        <span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
        <span class="s1">&#39;ONLY_NEW&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s1">&#39;TIMEOUT&#39;</span><span class="p">:</span>                  <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">},</span>
        <span class="s1">&#39;MEDIA_TIMEOUT&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">},</span>
        <span class="s1">&#39;OUTPUT_PERMISSIONS&#39;</span><span class="p">:</span>       <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;755&#39;</span><span class="p">},</span>
        <span class="s1">&#39;FOOTER_INFO&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;Content is hosted for personal archiving purposes only.  Contact server owner for any takedown requests.&#39;</span><span class="p">},</span>
        <span class="s1">&#39;URL_BLACKLIST&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="p">},</span>

    <span class="s1">&#39;ARCHIVE_METHOD_TOGGLES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;SAVE_TITLE&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_TITLE&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_FAVICON&#39;</span><span class="p">:</span>             <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_FAVICON&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_WGET&#39;</span><span class="p">:</span>                <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_WGET&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_WGET_REQUISITES&#39;</span><span class="p">:</span>     <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_WGET_REQUISITES&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_PDF&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_PDF&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_SCREENSHOT&#39;</span><span class="p">:</span>          <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_SCREENSHOT&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_DOM&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_DOM&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_WARC&#39;</span><span class="p">:</span>                <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_WARC&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_GIT&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_GIT&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_MEDIA&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FETCH_MEDIA&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;SAVE_ARCHIVE_DOT_ORG&#39;</span><span class="p">:</span>     <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;SUBMIT_ARCHIVE_DOT_ORG&#39;</span><span class="p">,)},</span>
    <span class="p">},</span>

    <span class="s1">&#39;ARCHIVE_METHOD_OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;RESOLUTION&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;1440,2000&#39;</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;SCREENSHOT_RESOLUTION&#39;</span><span class="p">,)},</span>
        <span class="s1">&#39;GIT_DOMAINS&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;github.com,bitbucket.org,gitlab.com&#39;</span><span class="p">},</span>
        <span class="s1">&#39;CHECK_SSL_VALIDITY&#39;</span><span class="p">:</span>       <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>

        <span class="s1">&#39;WGET_USER_AGENT&#39;</span><span class="p">:</span>          <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;ArchiveBox/</span><span class="si">{VERSION}</span><span class="s1"> (+https://github.com/pirate/ArchiveBox/) wget/</span><span class="si">{WGET_VERSION}</span><span class="s1">&#39;</span><span class="p">},</span>
        <span class="s1">&#39;CHROME_USER_AGENT&#39;</span><span class="p">:</span>        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.75 Safari/537.36&#39;</span><span class="p">},</span>

        <span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">:</span>             <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
        <span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">:</span>     <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>

        <span class="s1">&#39;CHROME_HEADLESS&#39;</span><span class="p">:</span>          <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s1">&#39;CHROME_SANDBOX&#39;</span><span class="p">:</span>           <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="p">},</span>

    <span class="s1">&#39;DEPENDENCY_CONFIG&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;USE_CURL&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s1">&#39;USE_WGET&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s1">&#39;USE_GIT&#39;</span><span class="p">:</span>                  <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s1">&#39;USE_CHROME&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s1">&#39;USE_YOUTUBEDL&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>

        <span class="s1">&#39;CURL_BINARY&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;curl&#39;</span><span class="p">},</span>
        <span class="s1">&#39;GIT_BINARY&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;git&#39;</span><span class="p">},</span>
        <span class="s1">&#39;WGET_BINARY&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;wget&#39;</span><span class="p">},</span>
        <span class="s1">&#39;YOUTUBEDL_BINARY&#39;</span><span class="p">:</span>         <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;youtube-dl&#39;</span><span class="p">},</span>
        <span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>   <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">CONFIG_ALIASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">alias</span><span class="p">:</span> <span class="n">key</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">CONFIG_DEFAULTS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">default</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aliases&#39;</span><span class="p">,</span> <span class="p">())</span>
<span class="p">}</span>
<span class="n">USER_CONFIG</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">CONFIG_DEFAULTS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<div class="viewcode-block" id="get_real_name"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.get_real_name">[docs]</a><span class="k">def</span> <span class="nf">get_real_name</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">CONFIG_ALIASES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>

<span class="c1">############################## Derived Config ##############################</span>

<span class="c1"># Constants</span>

<span class="n">DEFAULT_CLI_COLORS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;reset&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[00;00m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lightblue&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;30m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lightyellow&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;33m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lightred&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;35m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;31m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;32m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;34m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;white&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;37m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;black&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[01;30m&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ANSI</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">DEFAULT_CLI_COLORS</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>


<span class="n">VERSION_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;VERSION&#39;</span>
<span class="n">PYTHON_DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;archivebox&#39;</span>
<span class="n">TEMPLATES_DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;themes&#39;</span>

<span class="n">ARCHIVE_DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;archive&#39;</span>
<span class="n">SOURCES_DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;sources&#39;</span>
<span class="n">LOGS_DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span>
<span class="n">STATIC_DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
<span class="n">SQL_INDEX_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;index.sqlite3&#39;</span>
<span class="n">JSON_INDEX_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;index.json&#39;</span>
<span class="n">HTML_INDEX_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;index.html&#39;</span>
<span class="n">ROBOTS_TXT_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;robots.txt&#39;</span>
<span class="n">FAVICON_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;favicon.ico&#39;</span>
<span class="n">CONFIG_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;ArchiveBox.conf&#39;</span>

<span class="n">CONFIG_HEADER</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&quot;&quot;&quot;# This is the config file for your ArchiveBox collection.</span>
<span class="sd">#</span>
<span class="sd"># You can add options here manually in INI format, or automatically by running:</span>
<span class="sd">#    archivebox config --set KEY=VALUE</span>
<span class="sd"># </span>
<span class="sd"># If you modify this file manually, make sure to update your archive after by running:</span>
<span class="sd">#    archivebox init</span>
<span class="sd">#</span>
<span class="sd"># A list of all possible config with documentation and examples can be found here:</span>
<span class="sd">#    https://github.com/pirate/ArchiveBox/wiki/Configuration</span>

<span class="sd">&quot;&quot;&quot;</span><span class="p">)</span>


<span class="n">DERIVED_CONFIG_DEFAULTS</span><span class="p">:</span> <span class="n">ConfigDefaultDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;TERM_WIDTH&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">columns</span><span class="p">},</span>
    <span class="s1">&#39;USER&#39;</span><span class="p">:</span>                     <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getlogin</span><span class="p">()},</span>
    <span class="s1">&#39;ANSI&#39;</span><span class="p">:</span>                     <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">DEFAULT_CLI_COLORS</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_COLOR&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">DEFAULT_CLI_COLORS</span><span class="o">.</span><span class="n">keys</span><span class="p">()}},</span>
    
    <span class="s1">&#39;REPO_DIR&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">))},</span>
    <span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;REPO_DIR&#39;</span><span class="p">],</span> <span class="n">PYTHON_DIR_NAME</span><span class="p">)},</span>
    <span class="s1">&#39;TEMPLATES_DIR&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">],</span> <span class="n">TEMPLATES_DIR_NAME</span><span class="p">,</span> <span class="s1">&#39;legacy&#39;</span><span class="p">)},</span>
    
    <span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)},</span>
    <span class="s1">&#39;ARCHIVE_DIR&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">ARCHIVE_DIR_NAME</span><span class="p">)},</span>
    <span class="s1">&#39;SOURCES_DIR&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">SOURCES_DIR_NAME</span><span class="p">)},</span>
    <span class="s1">&#39;LOGS_DIR&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">LOGS_DIR_NAME</span><span class="p">)},</span>
    <span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">CONFIG_FILENAME</span><span class="p">)},</span>
    <span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">:</span>             <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">]))},</span>
    <span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">:</span>     <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">find_chrome_data_dir</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">]))</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)},</span>
    <span class="s1">&#39;URL_BLACKLIST_PTN&#39;</span><span class="p">:</span>        <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;URL_BLACKLIST&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;URL_BLACKLIST&#39;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)},</span>

    <span class="s1">&#39;ARCHIVEBOX_BINARY&#39;</span><span class="p">:</span>        <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
    <span class="s1">&#39;VERSION&#39;</span><span class="p">:</span>                  <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">],</span> <span class="n">VERSION_FILENAME</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()},</span>
    <span class="s1">&#39;GIT_SHA&#39;</span><span class="p">:</span>                  <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;VERSION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;unknown&#39;</span><span class="p">},</span>

    <span class="s1">&#39;PYTHON_BINARY&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">},</span>
    <span class="s1">&#39;PYTHON_ENCODING&#39;</span><span class="p">:</span>          <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">encoding</span><span class="o">.</span><span class="n">upper</span><span class="p">()},</span>
    <span class="s1">&#39;PYTHON_VERSION&#39;</span><span class="p">:</span>           <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span><span class="p">)},</span>

    <span class="s1">&#39;DJANGO_BINARY&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">django</span><span class="o">.</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__init__.py&#39;</span><span class="p">,</span> <span class="s1">&#39;bin/django-admin.py&#39;</span><span class="p">)},</span>
    <span class="s1">&#39;DJANGO_VERSION&#39;</span><span class="p">:</span>           <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">django</span><span class="o">.</span><span class="n">VERSION</span><span class="p">)},</span>

    <span class="s1">&#39;USE_CURL&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CURL&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_FAVICON&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_ARCHIVE_DOT_ORG&#39;</span><span class="p">])},</span>
    <span class="s1">&#39;CURL_VERSION&#39;</span><span class="p">:</span>             <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">bin_version</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;CURL_BINARY&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CURL&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">},</span>
    <span class="s1">&#39;SAVE_FAVICON&#39;</span><span class="p">:</span>             <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CURL&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_FAVICON&#39;</span><span class="p">]},</span>
    <span class="s1">&#39;SAVE_ARCHIVE_DOT_ORG&#39;</span><span class="p">:</span>     <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CURL&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_ARCHIVE_DOT_ORG&#39;</span><span class="p">]},</span>

    <span class="s1">&#39;USE_WGET&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_WGET&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_WGET&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_WARC&#39;</span><span class="p">])},</span>
    <span class="s1">&#39;WGET_VERSION&#39;</span><span class="p">:</span>             <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">bin_version</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;WGET_BINARY&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_WGET&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">},</span>
    <span class="s1">&#39;WGET_AUTO_COMPRESSION&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">wget_supports_compression</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_WGET&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">False</span><span class="p">},</span>
    <span class="s1">&#39;WGET_USER_AGENT&#39;</span><span class="p">:</span>          <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;WGET_USER_AGENT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">c</span><span class="p">)},</span>
    <span class="s1">&#39;SAVE_WGET&#39;</span><span class="p">:</span>                <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_WGET&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_WGET&#39;</span><span class="p">]},</span>
    <span class="s1">&#39;SAVE_WARC&#39;</span><span class="p">:</span>                <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_WGET&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_WARC&#39;</span><span class="p">]},</span>

    <span class="s1">&#39;USE_GIT&#39;</span><span class="p">:</span>                  <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_GIT&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_GIT&#39;</span><span class="p">]},</span>
    <span class="s1">&#39;GIT_VERSION&#39;</span><span class="p">:</span>              <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">bin_version</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;GIT_BINARY&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_GIT&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">},</span>
    <span class="s1">&#39;SAVE_GIT&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_GIT&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_GIT&#39;</span><span class="p">]},</span>

    <span class="s1">&#39;USE_YOUTUBEDL&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_YOUTUBEDL&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_MEDIA&#39;</span><span class="p">]},</span>
    <span class="s1">&#39;YOUTUBEDL_VERSION&#39;</span><span class="p">:</span>        <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">bin_version</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;YOUTUBEDL_BINARY&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_YOUTUBEDL&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">},</span>
    <span class="s1">&#39;SAVE_MEDIA&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_YOUTUBEDL&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_MEDIA&#39;</span><span class="p">]},</span>

    <span class="s1">&#39;USE_CHROME&#39;</span><span class="p">:</span>               <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_PDF&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_SCREENSHOT&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_DOM&#39;</span><span class="p">])},</span>
    <span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">:</span>            <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">find_chrome_binary</span><span class="p">()},</span>
    <span class="s1">&#39;CHROME_VERSION&#39;</span><span class="p">:</span>           <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">bin_version</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">},</span>
    <span class="s1">&#39;SAVE_PDF&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_PDF&#39;</span><span class="p">]},</span>
    <span class="s1">&#39;SAVE_SCREENSHOT&#39;</span><span class="p">:</span>          <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_SCREENSHOT&#39;</span><span class="p">]},</span>
    <span class="s1">&#39;SAVE_DOM&#39;</span><span class="p">:</span>                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;SAVE_DOM&#39;</span><span class="p">]},</span>

    <span class="s1">&#39;DEPENDENCIES&#39;</span><span class="p">:</span>             <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">get_dependency_info</span><span class="p">(</span><span class="n">c</span><span class="p">)},</span>
    <span class="s1">&#39;CODE_LOCATIONS&#39;</span><span class="p">:</span>           <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">get_code_locations</span><span class="p">(</span><span class="n">c</span><span class="p">)},</span>
    <span class="s1">&#39;EXTERNAL_LOCATIONS&#39;</span><span class="p">:</span>       <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">get_external_locations</span><span class="p">(</span><span class="n">c</span><span class="p">)},</span>
    <span class="s1">&#39;DATA_LOCATIONS&#39;</span><span class="p">:</span>           <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">get_data_locations</span><span class="p">(</span><span class="n">c</span><span class="p">)},</span>
    <span class="s1">&#39;CHROME_OPTIONS&#39;</span><span class="p">:</span>           <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">get_chrome_info</span><span class="p">(</span><span class="n">c</span><span class="p">)},</span>
<span class="p">}</span>



<span class="c1">################################### Helpers ####################################</span>

<div class="viewcode-block" id="load_config_val"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.load_config_val">[docs]</a><span class="k">def</span> <span class="nf">load_config_val</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">default</span><span class="p">:</span> <span class="n">ConfigDefaultValue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConfigDict</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">env_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">_Environ</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">config_file_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigValue</span><span class="p">:</span>

    <span class="n">config_keys_to_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">aliases</span> <span class="ow">or</span> <span class="p">()))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config_keys_to_check</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">env_vars</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">env_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">config_file_vars</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">config_file_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">default</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">default</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">default</span>
    
    <span class="k">elif</span> <span class="nb">type</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Invalid configuration option </span><span class="si">{key}</span><span class="s1">=</span><span class="si">{val}</span><span class="s1"> (expected a boolean: True/False)&#39;</span><span class="p">)</span> 

    <span class="k">elif</span> <span class="nb">type</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Invalid configuration option </span><span class="si">{key}</span><span class="s1">=</span><span class="si">{val}</span><span class="s1"> (expected a string)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">elif</span> <span class="nb">type</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Invalid configuration option </span><span class="si">{key}</span><span class="s1">=</span><span class="si">{val}</span><span class="s1"> (expected an integer)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Config values can only be str, bool, or int&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="load_config_file"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.load_config_file">[docs]</a><span class="k">def</span> <span class="nf">load_config_file</span><span class="p">(</span><span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;load the ini-formatted config file from OUTPUT_DIR/Archivebox.conf&quot;&quot;&quot;</span>

    <span class="n">out_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">CONFIG_FILENAME</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config_file</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span> 
        <span class="n">config_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
        <span class="c1"># flatten into one namespace</span>
        <span class="n">config_file_vars</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">val</span>
            <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">options</span> <span class="ow">in</span> <span class="n">config_file</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># print(&#39;[i] Loaded config file&#39;, os.path.abspath(config_path))</span>
        <span class="c1"># print(config_file_vars)</span>
        <span class="k">return</span> <span class="n">config_file_vars</span>
    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="write_config_file"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.write_config_file">[docs]</a><span class="k">def</span> <span class="nf">write_config_file</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigDict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;load the ini-formatted config file from OUTPUT_DIR/Archivebox.conf&quot;&quot;&quot;</span>

    <span class="n">out_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">CONFIG_FILENAME</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">CONFIG_HEADER</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config_file</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">config_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>

    <span class="n">find_section</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">CONFIG_DEFAULTS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{config_path}</span><span class="s1">.old&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">old</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new</span><span class="p">:</span>
            <span class="n">old</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">find_section</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">config_file</span><span class="p">:</span>
                <span class="n">existing_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">config_file</span><span class="p">[</span><span class="n">section</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">existing_config</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">config_file</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">existing_config</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>

        <span class="n">config_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">CONFIG</span> <span class="o">=</span> <span class="n">load_all_config</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{config_path}</span><span class="s1">.old&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">old</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{config_path}</span><span class="s1">.old&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{config_path}</span><span class="s1">.old&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{}</span></div>

   

<div class="viewcode-block" id="load_config"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.load_config">[docs]</a><span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="n">defaults</span><span class="p">:</span> <span class="n">ConfigDefaultDict</span><span class="p">,</span>
                <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConfigDict</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">env_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">_Environ</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">config_file_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigDict</span><span class="p">:</span>
    
    <span class="n">env_vars</span> <span class="o">=</span> <span class="n">env_vars</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
    <span class="n">config_file_vars</span> <span class="o">=</span> <span class="n">config_file_vars</span> <span class="ow">or</span> <span class="n">load_config_file</span><span class="p">(</span><span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">)</span>

    <span class="n">extended_config</span><span class="p">:</span> <span class="n">ConfigDict</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">config</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">extended_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_config_val</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">],</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">default</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span>
                <span class="n">aliases</span><span class="o">=</span><span class="n">default</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aliases&#39;</span><span class="p">),</span>
                <span class="n">config</span><span class="o">=</span><span class="n">extended_config</span><span class="p">,</span>
                <span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span>
                <span class="n">config_file_vars</span><span class="o">=</span><span class="n">config_file_vars</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">stderr</span><span class="p">()</span>
            <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[X] Error while loading configuration value: </span><span class="si">{key}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">extended_config</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="n">stderr</span><span class="p">()</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Check your config for mistakes and try again (your archive data is unaffected).&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">()</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    For config documentation and examples see:&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        https://github.com/pirate/ArchiveBox/wiki/Configuration&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">()</span>
            <span class="k">raise</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">extended_config</span></div>

<span class="c1"># def write_config(config: ConfigDict):</span>

<span class="c1">#     with open(os.path.join(config[&#39;OUTPUT_DIR&#39;], CONFIG_FILENAME), &#39;w+&#39;) as f:</span>



<div class="viewcode-block" id="stderr"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.stderr">[docs]</a><span class="k">def</span> <span class="nf">stderr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConfigDict</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">ansi</span> <span class="o">=</span> <span class="n">DEFAULT_CLI_COLORS</span> <span class="k">if</span> <span class="p">(</span><span class="n">config</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;USE_COLOR&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">ANSI</span>

    <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
        <span class="n">strs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ansi</span><span class="p">[</span><span class="n">color</span><span class="p">],</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">),</span> <span class="n">ansi</span><span class="p">[</span><span class="s1">&#39;reset&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">strs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strs</span><span class="p">))</span></div>

<div class="viewcode-block" id="bin_version"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.bin_version">[docs]</a><span class="k">def</span> <span class="nf">bin_version</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;check the presence and return valid version line of a specified binary&quot;&quot;&quot;</span>

    <span class="n">abspath</span> <span class="o">=</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">abspath</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">version_str</span> <span class="o">=</span> <span class="n">run</span><span class="p">([</span><span class="n">abspath</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="c1"># take first 3 columns of first line of version info</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">version_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># stderr(f&#39;[X] Unable to find working version of dependency: {binary}&#39;, color=&#39;red&#39;)</span>
        <span class="c1"># stderr(&#39;    Make sure it\&#39;s installed, then confirm it\&#39;s working by running:&#39;)</span>
        <span class="c1"># stderr(f&#39;        {binary} --version&#39;)</span>
        <span class="c1"># stderr()</span>
        <span class="c1"># stderr(&#39;    If you don\&#39;t want to install it, you can disable it via config. See here for more info:&#39;)</span>
        <span class="c1"># stderr(&#39;        https://github.com/pirate/ArchiveBox/wiki/Install&#39;)</span>
        <span class="c1"># stderr()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="bin_path"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.bin_path">[docs]</a><span class="k">def</span> <span class="nf">bin_path</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">binary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">binary</span><span class="p">))</span> <span class="ow">or</span> <span class="n">binary</span></div>

<div class="viewcode-block" id="bin_hash"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.bin_hash">[docs]</a><span class="k">def</span> <span class="nf">bin_hash</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">abs_path</span> <span class="o">=</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">abs_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">file_hash</span> <span class="o">=</span> <span class="n">md5</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">abs_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">file_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;md5:{file_hash.hexdigest()}&#39;</span></div>

<div class="viewcode-block" id="find_chrome_binary"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.find_chrome_binary">[docs]</a><span class="k">def</span> <span class="nf">find_chrome_binary</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;find any installed chrome binaries in the default locations&quot;&quot;&quot;</span>
    <span class="c1"># Precedence: Chromium, Chrome, Beta, Canary, Unstable, Dev</span>
    <span class="c1"># make sure data dir finding precedence order always matches binary finding order</span>
    <span class="n">default_executable_paths</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;chromium-browser&#39;</span><span class="p">,</span>
        <span class="s1">&#39;chromium&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/Applications/Chromium.app/Contents/MacOS/Chromium&#39;</span><span class="p">,</span>
        <span class="s1">&#39;google-chrome&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/Applications/Google Chrome.app/Contents/MacOS/Google Chrome&#39;</span><span class="p">,</span>
        <span class="s1">&#39;google-chrome-stable&#39;</span><span class="p">,</span>
        <span class="s1">&#39;google-chrome-beta&#39;</span><span class="p">,</span>
        <span class="s1">&#39;google-chrome-canary&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/Applications/Google Chrome Canary.app/Contents/MacOS/Google Chrome Canary&#39;</span><span class="p">,</span>
        <span class="s1">&#39;google-chrome-unstable&#39;</span><span class="p">,</span>
        <span class="s1">&#39;google-chrome-dev&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">default_executable_paths</span><span class="p">:</span>
        <span class="n">full_path_exists</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">full_path_exists</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
    
    <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;[X] Unable to find a working version of Chrome/Chromium, is it installed and in your $PATH?&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">stderr</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="find_chrome_data_dir"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.find_chrome_data_dir">[docs]</a><span class="k">def</span> <span class="nf">find_chrome_data_dir</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;find any installed chrome user data directories in the default locations&quot;&quot;&quot;</span>
    <span class="c1"># Precedence: Chromium, Chrome, Beta, Canary, Unstable, Dev</span>
    <span class="c1"># make sure data dir finding precedence order always matches binary finding order</span>
    <span class="n">default_profile_paths</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;~/.config/chromium&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/Library/Application Support/Chromium&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/AppData/Local/Chromium/User Data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/.config/google-chrome&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/Library/Application Support/Google/Chrome&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/AppData/Local/Google/Chrome/User Data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/.config/google-chrome-stable&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/.config/google-chrome-beta&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/Library/Application Support/Google/Chrome Canary&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/AppData/Local/Google/Chrome SxS/User Data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/.config/google-chrome-unstable&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~/.config/google-chrome-dev&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">default_profile_paths</span><span class="p">:</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">full_path</span>
    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="wget_supports_compression"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.wget_supports_compression">[docs]</a><span class="k">def</span> <span class="nf">wget_supports_compression</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;WGET_BINARY&#39;</span><span class="p">],</span>
        <span class="s2">&quot;--compression=auto&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--help&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">DEVNULL</span><span class="p">)</span><span class="o">.</span><span class="n">returncode</span></div>

<div class="viewcode-block" id="get_code_locations"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.get_code_locations">[docs]</a><span class="k">def</span> <span class="nf">get_code_locations</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimpleConfigValueDict</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;REPO_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;REPO_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;REPO_DIR&#39;</span><span class="p">],</span> <span class="s1">&#39;archivebox&#39;</span><span class="p">)),</span>
        <span class="p">},</span>
        <span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">],</span> <span class="s1">&#39;__main__.py&#39;</span><span class="p">)),</span>
        <span class="p">},</span>
        <span class="s1">&#39;TEMPLATES_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TEMPLATES_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TEMPLATES_DIR&#39;</span><span class="p">],</span> <span class="s1">&#39;static&#39;</span><span class="p">)),</span>
        <span class="p">},</span>
    <span class="p">}</span></div>

<div class="viewcode-block" id="get_external_locations"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.get_external_locations">[docs]</a><span class="k">def</span> <span class="nf">get_external_locations</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigValue</span><span class="p">:</span>
    <span class="n">abspath</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">path</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">],</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">],</span> <span class="s1">&#39;Default&#39;</span><span class="p">)),</span>
        <span class="p">},</span>
        <span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_WGET&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">],</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;COOKIES_FILE&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
    <span class="p">}</span></div>

<div class="viewcode-block" id="get_data_locations"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.get_data_locations">[docs]</a><span class="k">def</span> <span class="nf">get_data_locations</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigValue</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">JSON_INDEX_FILENAME</span><span class="p">)),</span>
        <span class="p">},</span>
        <span class="s1">&#39;SOURCES_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SOURCES_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SOURCES_DIR&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;LOGS_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;LOGS_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;LOGS_DIR&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;ARCHIVE_DIR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ARCHIVE_DIR&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ARCHIVE_DIR&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;SQL_INDEX&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">SQL_INDEX_FILENAME</span><span class="p">)),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">SQL_INDEX_FILENAME</span><span class="p">)),</span>
        <span class="p">},</span>
        <span class="s1">&#39;JSON_INDEX&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">JSON_INDEX_FILENAME</span><span class="p">)),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">JSON_INDEX_FILENAME</span><span class="p">)),</span>
        <span class="p">},</span>
        <span class="s1">&#39;HTML_INDEX&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">HTML_INDEX_FILENAME</span><span class="p">)),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">],</span> <span class="n">HTML_INDEX_FILENAME</span><span class="p">)),</span>
        <span class="p">},</span>
    <span class="p">}</span></div>

<div class="viewcode-block" id="get_dependency_info"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.get_dependency_info">[docs]</a><span class="k">def</span> <span class="nf">get_dependency_info</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigValue</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;PYTHON_BINARY&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_VERSION&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">bin_hash</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DJANGO_VERSION&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;DJANGO_BINARY&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DJANGO_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DJANGO_VERSION&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">bin_hash</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DJANGO_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DJANGO_VERSION&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;CURL_BINARY&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CURL_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CURL_VERSION&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">bin_hash</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_CURL&#39;</span><span class="p">],</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CURL_VERSION&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;WGET_BINARY&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;WGET_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;WGET_VERSION&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">bin_hash</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;WGET_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_WGET&#39;</span><span class="p">],</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;WGET_VERSION&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;GIT_BINARY&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;GIT_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;GIT_VERSION&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">bin_hash</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;GIT_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_GIT&#39;</span><span class="p">],</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;GIT_VERSION&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;YOUTUBEDL_BINARY&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;YOUTUBEDL_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;YOUTUBEDL_VERSION&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">bin_hash</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;YOUTUBEDL_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_YOUTUBEDL&#39;</span><span class="p">],</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;YOUTUBEDL_VERSION&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
        <span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">bin_path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_VERSION&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">bin_hash</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">],</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_VERSION&#39;</span><span class="p">]),</span>
        <span class="p">},</span>
    <span class="p">}</span></div>

<div class="viewcode-block" id="get_chrome_info"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.get_chrome_info">[docs]</a><span class="k">def</span> <span class="nf">get_chrome_info</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigValue</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;TIMEOUT&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;TIMEOUT&#39;</span><span class="p">],</span>
        <span class="s1">&#39;RESOLUTION&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;RESOLUTION&#39;</span><span class="p">],</span>
        <span class="s1">&#39;CHECK_SSL_VALIDITY&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHECK_SSL_VALIDITY&#39;</span><span class="p">],</span>
        <span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_BINARY&#39;</span><span class="p">],</span>
        <span class="s1">&#39;CHROME_HEADLESS&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_HEADLESS&#39;</span><span class="p">],</span>
        <span class="s1">&#39;CHROME_SANDBOX&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_SANDBOX&#39;</span><span class="p">],</span>
        <span class="s1">&#39;CHROME_USER_AGENT&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_AGENT&#39;</span><span class="p">],</span>
        <span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">],</span>
    <span class="p">}</span></div>


<span class="c1">################################## Load Config #################################</span>


<div class="viewcode-block" id="load_all_config"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.load_all_config">[docs]</a><span class="k">def</span> <span class="nf">load_all_config</span><span class="p">():</span>
    <span class="n">CONFIG</span><span class="p">:</span> <span class="n">ConfigDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">section_name</span><span class="p">,</span> <span class="n">section_config</span> <span class="ow">in</span> <span class="n">CONFIG_DEFAULTS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">CONFIG</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="n">section_config</span><span class="p">,</span> <span class="n">CONFIG</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">load_config</span><span class="p">(</span><span class="n">DERIVED_CONFIG_DEFAULTS</span><span class="p">,</span> <span class="n">CONFIG</span><span class="p">)</span></div>

<span class="n">CONFIG</span> <span class="o">=</span> <span class="n">load_all_config</span><span class="p">()</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CONFIG</span><span class="p">)</span>


<span class="c1">############################## Importable Checkers #############################</span>

<div class="viewcode-block" id="check_system_config"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.check_system_config">[docs]</a><span class="k">def</span> <span class="nf">check_system_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="o">=</span><span class="n">CONFIG</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1">### Check system environment</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USER&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;[!] ArchiveBox should never be run as root!&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    For more information, see the security overview documentation:&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        https://github.com/pirate/ArchiveBox/wiki/Security-Overview#do-not-run-as-root&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">### Check Python environment</span>
    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_VERSION&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">3.6</span><span class="p">:</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[X] Python version is not new enough: </span><span class="si">{config[&quot;PYTHON_VERSION&quot;]}</span><span class="s1"> (&gt;3.6 is required)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    See https://github.com/pirate/ArchiveBox/wiki/Troubleshooting#python for help upgrading your Python installation.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_ENCODING&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="s1">&#39;UTF8&#39;</span><span class="p">):</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[X] Your system is running python3 scripts with a bad locale setting: </span><span class="si">{config[&quot;PYTHON_ENCODING&quot;]}</span><span class="s1"> (it should be UTF-8).&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    To fix it, add the line &quot;export PYTHONIOENCODING=UTF-8&quot; to your ~/.bashrc file (without quotes)&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Or if you</span><span class="se">\&#39;</span><span class="s1">re using ubuntu/debian, run &quot;dpkg-reconfigure locales&quot;&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Confirm that it</span><span class="se">\&#39;</span><span class="s1">s fixed by opening a new shell and running:&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        python3 -c &quot;import sys; print(sys.stdout.encoding)&quot;   # should output UTF-8&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># stderr(&#39;[i] Using Chrome binary: {}&#39;.format(shutil.which(CHROME_BINARY) or CHROME_BINARY))</span>
    <span class="c1"># stderr(&#39;[i] Using Chrome data dir: {}&#39;.format(os.path.abspath(CHROME_USER_DATA_DIR)))</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">],</span> <span class="s1">&#39;Default&#39;</span><span class="p">)):</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;[X] Could not find profile &quot;Default&quot; in CHROME_USER_DATA_DIR.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;    </span><span class="si">{config[&quot;CHROME_USER_DATA_DIR&quot;]}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Make sure you set it to a Chrome user data directory containing a Default profile folder.&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    For more info see:&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        https://github.com/pirate/ArchiveBox/wiki/Configuration#CHROME_USER_DATA_DIR&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Default&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">]:</span>
                <span class="n">stderr</span><span class="p">()</span>
                <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Try removing /Default from the end e.g.:&#39;</span><span class="p">)</span>
                <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        CHROME_USER_DATA_DIR=&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHROME_USER_DATA_DIR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/Default&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="check_dependencies"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.check_dependencies">[docs]</a><span class="k">def</span> <span class="nf">check_dependencies</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="o">=</span><span class="n">CONFIG</span><span class="p">,</span> <span class="n">show_help</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">invalid</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;unable to find binary&#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;unable to detect version&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEPENDENCIES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;is_valid&#39;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;[X] Missing some required dependencies.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">show_help</span><span class="p">:</span>
            <span class="n">stderr</span><span class="p">()</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    To get more info on dependency status run:&#39;</span><span class="p">)</span>
            <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        archivebox --version&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;TIMEOUT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[!] Warning: TIMEOUT is set too low! (currently set to TIMEOUT=</span><span class="si">{config[&quot;TIMEOUT&quot;]}</span><span class="s1"> seconds)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    You must allow *at least* 5 seconds for indexing and archive methods to run succesfully.&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    (Setting it to somewhere between 30 and 300 seconds is recommended)&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    If you want to make ArchiveBox run faster, disable specific archive methods instead:&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        https://github.com/pirate/ArchiveBox/wiki/Configuration#archive-method-toggles&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_CHROME&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;TIMEOUT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[!] Warning: TIMEOUT is set too low! (currently set to TIMEOUT=</span><span class="si">{config[&quot;TIMEOUT&quot;]}</span><span class="s1"> seconds)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Chrome will fail to archive all sites if set to less than ~15 seconds.&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    (Setting it to somewhere between 30 and 300 seconds is recommended)&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    If you want to make ArchiveBox run faster, disable specific archive methods instead:&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        https://github.com/pirate/ArchiveBox/wiki/Configuration#archive-method-toggles&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;USE_YOUTUBEDL&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;MEDIA_TIMEOUT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[!] Warning: MEDIA_TIMEOUT is set too low! (currently set to MEDIA_TIMEOUT=</span><span class="si">{config[&quot;MEDIA_TIMEOUT&quot;]}</span><span class="s1"> seconds)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Youtube-dl will fail to archive all media if set to less than ~20 seconds.&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    (Setting it somewhere over 60 seconds is recommended)&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    If you want to disable media archiving entirely, set SAVE_MEDIA=False instead:&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        https://github.com/pirate/ArchiveBox/wiki/Configuration#save_media&#39;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="check_data_folder"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.check_data_folder">[docs]</a><span class="k">def</span> <span class="nf">check_data_folder</span><span class="p">(</span><span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="o">=</span><span class="n">CONFIG</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="ow">or</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="n">json_index_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">JSON_INDEX_FILENAME</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">json_index_exists</span><span class="p">:</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;[X] No archive main index was found in current directory.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;    </span><span class="si">{output_dir}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    Are you running archivebox in the right folder?&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        cd path/to/your/archive/folder&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        archivebox [command]&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;    To create a new archive collection or import existing data in this folder, run:&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        archivebox init&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">sql_index_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">SQL_INDEX_FILENAME</span><span class="p">))</span>
    <span class="kn">from</span> <span class="nn">..index.sql</span> <span class="k">import</span> <span class="n">list_migrations</span>

    <span class="n">pending_migrations</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">status</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">list_migrations</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">sql_index_exists</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pending_migrations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sql_index_exists</span><span class="p">:</span>
            <span class="n">pending_operation</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;apply the {len(pending_migrations)} pending migrations&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pending_operation</span> <span class="o">=</span> <span class="s1">&#39;generate the new SQL main index&#39;</span>

        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;[X] This collection was created with an older version of ArchiveBox and must be upgraded first.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightyellow&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;    </span><span class="si">{output_dir}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">()</span>
        <span class="n">stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;    To upgrade it to the latest version and </span><span class="si">{pending_operation}</span><span class="s1"> run:&#39;</span><span class="p">)</span>
        <span class="n">stderr</span><span class="p">(</span><span class="s1">&#39;        archivebox init&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></div>



<div class="viewcode-block" id="setup_django"><a class="viewcode-back" href="../../archivebox.config.html#archivebox.config.setup_django">[docs]</a><span class="k">def</span> <span class="nf">setup_django</span><span class="p">(</span><span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">check_db</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="o">=</span><span class="n">CONFIG</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="ow">or</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">django</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYTHON_DIR&#39;</span><span class="p">])</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;core.settings&#39;</span><span class="p">)</span>
        <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">check_db</span><span class="p">:</span>
            <span class="n">sql_index_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">SQL_INDEX_FILENAME</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sql_index_path</span><span class="p">),</span> <span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;No database file </span><span class="si">{SQL_INDEX_FILENAME}</span><span class="s1"> found in OUTPUT_DIR: </span><span class="si">{config[&quot;OUTPUT_DIR&quot;]}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>

<span class="n">check_system_config</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Nick Sweeting

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>